{% extends "base.html" %}

{% block content %}
<div class="quote-public" style="max-width: 800px; margin: 30px auto; padding: 32px; background: #fff; border-radius: 18px; box-shadow: 0 3px 24px rgba(0,0,0,0.09);">
    <h1 style="color: #006178; margin-bottom: 20px;">Devis {{ quote.quote_number }}</h1>
    <p><b>Client :</b> {{ quote.client.nom }}</p>
    <p><b>Date :</b> {{ quote.issue_date|date:"d/m/Y" }}</p>
    <p><b>Montant total :</b> {{ quote.total_amount_ttc }} €</p>
    <hr style="margin: 24px 0;">
    <h3>Détails</h3>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align:left; border-bottom:1px solid #bbb;">Description</th>
                <th style="text-align:right; border-bottom:1px solid #bbb;">Quantité</th>
                <th style="text-align:right; border-bottom:1px solid #bbb;">Prix unitaire</th>
                <th style="text-align:right; border-bottom:1px solid #bbb;">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in quote.items.all %}
            <tr>
                <td>{{ item.description }}</td>
                <td style="text-align:right;">{{ item.quantity }}</td>
                <td style="text-align:right;">{{ item.unit_price_htva }} €</td>
                <td style="text-align:right;">{{ item.total_line_htva }} €</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 28px; text-align: right;">
        <a href="{% url 'documents:quote_public_pdf' quote.public_token %}" class="btn btn-success" style="background:#158c3c; color:#fff; padding:10px 20px; border-radius:6px; text-decoration:none; font-size:1.1em;">
            Télécharger le devis PDF
        </a>
    </div>

    <!-- Boutons accepter/refuser le devis -->
    <div style="margin-top: 20px; text-align: center;">
        {% if quote.status == "SENT" %}
            <a href="{% url 'documents:quote_accept' quote.public_token %}"
               class="btn btn-success"
               style="padding:10px 28px; background:#28a745; color:white; border-radius:8px; text-decoration:none; font-size:1.1em; margin-right:15px;">
                ✅ J'accepte le devis
            </a>
            <a href="{% url 'documents:quote_reject' quote.public_token %}"
               class="btn btn-warning"
               style="padding:10px 28px; background:#ffc107; color:#333; border-radius:8px; text-decoration:none; font-size:1.1em;">
                ❌ Je refuse
            </a>
        {% elif quote.status == "ACCEPTED" %}
            <div style="margin-top: 20px; color: #28a745; font-size: 1.1em;">✅ Ce devis a déjà été accepté.</div>
        {% elif quote.status == "REJECTED" %}
            <div style="margin-top: 20px; color: #c0392b; font-size: 1.1em;">❌ Ce devis a été refusé.</div>
        {% endif %}
    </div>
</div>
{% endblock %}
