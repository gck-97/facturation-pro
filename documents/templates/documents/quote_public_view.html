{% extends "base.html" %}

{% block content %}
<div class="quote-public" style="max-width: 800px; margin: 30px auto; padding: 32px; background: #fff; border-radius: 18px; box-shadow: 0 3px 24px rgba(0,0,0,0.09);">
    <h1 style="color: #006178; margin-bottom: 20px;">Devis {{ quote.quote_number }}</h1>
    <p><b>Client :</b> {{ quote.client.nom }}</p>
    <p><b>Date :</b> {{ quote.issue_date|date:"d/m/Y" }}</p>
    <p><b>Montant total :</b> {{ quote.total_amount_ttc }} ‚Ç¨</p>
    <hr style="margin: 24px 0;">
    <h3>D√©tails</h3>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align:left; border-bottom:1px solid #bbb;">Description</th>
                <th style="text-align:right; border-bottom:1px solid #bbb;">Quantit√©</th>
                <th style="text-align:right; border-bottom:1px solid #bbb;">Prix unitaire</th>
                <th style="text-align:right; border-bottom:1px solid #bbb;">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in quote.items.all %}
            <tr>
                <td>{{ item.description }}</td>
                <td style="text-align:right;">{{ item.quantity }}</td>
                <td style="text-align:right;">{{ item.unit_price_htva }} ‚Ç¨</td>
                <td style="text-align:right;">{{ item.total_line_htva }} ‚Ç¨</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 28px; text-align: right;">
        <a href="{% url 'documents:quote_public_pdf' quote.public_token %}" class="btn btn-success"
           style="background:#158c3c; color:#fff; padding:10px 20px; border-radius:6px; text-decoration:none; font-size:1.1em;">
            T√©l√©charger le devis PDF
        </a>
    </div>

    <!-- Statut et boutons accepter/refuser le devis -->
    <div style="margin-top: 30px; text-align: center;">
        {% if quote.status == "SENT" or quote.status == "Envoy√©" %}
            <div style="margin-top: 18px;">
                <a href="{% url 'documents:quote_accept' quote.public_token %}"
                   style="padding:10px 28px; background:#28a745; color:white; border-radius:8px; text-decoration:none; font-size:1.1em; margin-right:15px; display:inline-block;">
                    ‚úÖ J'accepte le devis
                </a>
                <a href="{% url 'documents:quote_reject' quote.public_token %}"
                   style="padding:10px 28px; background:#c0392b; color:white; border-radius:8px; text-decoration:none; font-size:1.1em; display:inline-block;">
                    ‚ùå Je refuse
                </a>
            </div>
        {% elif quote.status == "ACCEPTED" or quote.status == "Accept√©" %}
            <div style="margin-top: 20px; color: #28a745; font-size: 1.1em; font-weight:bold;">
                ‚úÖ Ce devis a d√©j√† √©t√© accept√©.
            </div>
        {% elif quote.status == "REJECTED" or quote.status == "Refus√©" %}
            <div style="margin-top: 20px; color: #c0392b; font-size: 1.1em; font-weight:bold;">
                ‚ùå Ce devis a √©t√© refus√©.
            </div>
        {% else %}
            <div style="margin-top: 20px; color: #b58b00; font-size: 1.1em; font-weight:bold;">
                üü° Ce devis n'a pas encore √©t√© envoy√© au client.
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
